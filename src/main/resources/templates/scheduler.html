<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Rezerwacja wizyty online</title>
    <link rel="stylesheet" type="text/css" href="../static/assets/css/site.css"
          th:href="@{/static/assets/css/site.css}">
    <link href="../static/assets/css/style.css" th:href="@{/static/assets/css/style.css}" type="text/css"
          rel="stylesheet"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"
            integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
    <script src="/static/assets/js/moment.js" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
            integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="/static/assets/js/scheduler.js"></script>
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
          integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script> -->
    <link rel="stylesheet" type="text/css" href="https://npmcdn.com/flatpickr/dist/themes/airbnb.css">
    <!-- <script src="https://npmcdn.com/flatpickr/dist/flatpickr.min.js"></script> -->
    <script src="https://npmcdn.com/flatpickr/dist/l10n/pl.js"></script>

    <link href='//lucas-rfgv.format.com/stylesheet.css?v=2019-10-30T10:05:15Z' media='screen' rel='stylesheet'
          type='text/css'/>

    <link
            href='https://static0.format.com/static/theme_api/v1/hosted_fonts-1fa30b0b16e206b04ff76bb76c5399ad06635e59d9fc2a338e015a0554cce89e.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static1.format.com/static/theme_api/vendor/webtype_fonts.min-51d9b9edb8f956fb39da113609d790ba607fa4fbda053af8e378bb9233ef4a39.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static2.format.com/static/theme_api/v1/share_panel-1a26721acae26eabd7c32296e2ee8cf053d1a1a8d9f7c49f0df899bc27b784c1.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static1.format.com/static/theme_api/v1/protected_images-2fdc6f85260105ac58908b513a09aa9c124e2007c6d4cbe63b3778f16e3a88b9.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static0.format.com/static/theme_api/v1/font-awesome.min-3149da3014aff38a256574aa7aa1b947387efee9cdc1fb2d39e234606f231c96.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static1.format.com/static/theme_api/v1/theme_social-c985894a58f09ef7b4feca674406de2916e87cbbb58d420fff1ac15b709ac68c.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static0.format.com/static/theme_api/v1/sales/cart-71d654c3aca9efaf7d54bb83a588db177f85a55f6d10afc1ecb96de9011222ee.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static1.format.com/static/theme_api/v1/960_simple-80ab8eb2695abe415bd536608db207267db1a467f2841da1c01b06c3559dd9c6.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static1.format.com/static/_common/animation-7fc12d665fca943072e7f3c6c84d756b935958c9d92f8a940de7dcfd69c2b253.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static0.format.com/static/_common/module_base-2fd98c28fcd54bcffcd91535e950cee231ed1628ef70fde2086ad0a6c70e968b.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static1.format.com/static/_common/contact_form-93a485ae0e43cbab1eeafa8172eb4cf0b2ff0c1265f036fe604ce7584c9dba90.css'
            media='screen' rel='stylesheet' type='text/css'/>

    <link
            href='https://static1.format.com/static/_common/modal_message-cd25c4ca398e1e31ca8276375f75a14991b41526bbfbeb42dbfa5d76d89cfce7.css'
            media='screen' rel='stylesheet' type='text/css'/>


    <script type="text/javascript" src="../static/assets/js/ps-datapicker.min.js"></script>

    <link href="../static/assets/css/ps-datapicker.theme.min.css" rel="stylesheet" type="text/css" media="screen"
          th:href="@{/static/assets/css/ps-datapicker.theme.min.css}">

    <style>
        /* #content_page_wrapper .btn {
            font-family: "Planet Light", "Planet Light", sans-serif
            border-color: rgba(85, 85, 85, 0.4) !important;
            background: #c12031 !important;
            color: white !important;
        } */

        #content_page_wrapper .btn:hover {
            border-color: #c12031 !important;
            background: #fff !important;
            color: #c12031 !important;
            transition: 0.3s;

        }
    </style>

    <style>
        #content_page_wrapper h2.xl-headline {
            font-size: 21px;
        }

        form div {
            padding: 5px;
        }

        @media screen and (max-width: 768px) {
            #content_page_wrapper h2.xl-headline {
                font-size: 18.2px;
            }

            #content_page_wrapper .spacer {
                width: 10% !important;
                display: none !important;
            }

            #content_page_wrapper .last {
                width: auto !important;
                float: inherit !important;
            }

            #content_page_wrapper .twelvecol {
                float: inherit !important;
                margin-left: 15% !important;
                margin-right: 15% !important;
            }

            #appts option {
                width: 60px;
            }

            #content_page_wrapper fieldset {

                float: right;
            }

        }
    </style>
    <style>
        .form-group {
            margin-bottom: 0rem;
            margin-top: 0.5rem;
        }
        #content_page_wrapper .cancel-btn{
            background: lightgray !important;
            color: black !important;
        }
        #content_page_wrapper .cancel-btn:hover{
            background: white !important;
            color: black !important;
            transition: 0.3s;
        }
        .btn {
            margin-top: 0px !important;
        }
    </style>

</head>

<body>

<div id="content">
    <div class="container loaded">
        <div class="_4ORMAT_content_wrapper" id="content_page_wrapper">
            <div style="padding-top: 0px"
                 class="_4ORMAT_content_page_row _4ormat_sort_item _4ORMAT_module_contact_10">


                <form class=" email_form" id="apptForm" data-editable-type="contact-form" name="contact_form_1"
                      th:object="${appointment}" th:action="@{/confirmation}" method="post">
                    <h2 style="margin: 5px">Rezerwacja wizyty online</h2>

                    <div class="appointmentDataPicker">
                        <input id="date" placeholder="Wybierz datę..." data-input="" type="text" readonly="readonly"
                               style="background-color: white !important;" name="appointmentDate" value="" hidden>
                        <div class="appointmentDataBox">
                            <div class="ps-datapicker">
                                <div class="navigation"></div>
                                <div class="week"></div>
                                <div class="month"></div>
                            </div>
                        </div>

                        <div class="appointmentTimeBox">
                            <div class="appointmentTimeButtons" style="display: none;">
                                <input id="Time_11" type="radio" value="11:00:00" name="appointmentTime"
                                       style="display: none;" disabled>
                                <label for="Time_11">11:00</label>
                                <input id="Time_13" type="radio" value="13:00:00" name="appointmentTime"
                                       style="display: none;" disabled>
                                <label for="Time_13">13:00</label>
                                <input id="Time_15" type="radio" value="15:00:00" name="appointmentTime"
                                       style="display: none;" disabled>
                                <label for="Time_15">15:00</label>
                            </div>
                        </div>

                    </div>

                    <div class="form-group" style="display: none;">

                        <input type="hidden" class="form-control" th:field="*{user}">
                        <input class="_4ORMAT_module_contact_input form-control" id="username"
                               th:field="*{firstName}" type="text" placeholder="" required>
                        <label class="form-control-placeholder" for="username">Podaj swoje imię</label>
                        <div class="_4ORMAT_module_contact_label">
                        </div>

                    </div>

                    <div class="appointment-button-group">
                        <a th:href="@{/menu}" class="cancel-btn" style="display: none;">Anuluj</a>

                        <fieldset class="submit _4ORMAT_module_submit" style="display: none;">
                            <input class="btn primary _4ORMAT_module_contact_btn _4ORMAT_module_contact_input"
                                   type="submit" value="submit" id="submitButton"
                                   style="border-color: rgba(85, 85, 85, 0.3); float: right">
                            </input>

                            <div class="_4ORMAT_module_contact_label  " data-editable-type="label" id="label_4"
                                 style="display:none;" data-force-html-mode="false">Zarezerwuj termin
                            </div>
                        </fieldset>

                    </div>
                </form>
            </div>
        </div>
        <!--                <div class="btn1 draw-border"-->
        <!--                     style="padding: 15px; margin:auto; text-align: center;; max-width: 250px">-->
        <!--                    <a th:href="@{/menu}" id="backtomenu">powrót do menu-->
        <!--                    </a>-->
        <!--                </div>-->
    </div>
</div>


<script
        src='https://static0.format.com/static/theme_api/v1/4ormat-7ec6872c8e665780eead7b027e2aa66fb06142caecd57b86359163172bf23497.js'
        type='text/javascript'></script>


<script
        src='https://static1.format.com/static/content_page-7e22221e690c345db9ee0a88104312831204bb61ca799fef76d3efce37ac8339.js'
        type='text/javascript'></script>

<script
        src='https://static0.format.com/static/_common/large_headline_shim-04d68b28db57598de64ddcbb8e143b86b89b4c6df47f86593d938b79c18c3bc7.js'
        type='text/javascript'></script>

<script
        src='https://static0.format.com/static/_common/contact_form-a6ae6c621dd884249e13a9fda7c5f28191902db17a4cfd926b19c696fc4bd309.js'
        type='text/javascript'></script>

<script
        src='https://static0.format.com/static/_common/colour_adjustments-007e264abb344638134a759453f16bebc5b209ed13f19f078cf0fd5f5c676be7.js'
        type='text/javascript'>

</script>

<script th:inline="javascript">
    const temp = /*[[${appointments}]]*/ null
    const leave = /*[[${leave}]]*/ null
    console.log(temp)
</script>
<script>
    const today = new Date();
    const offsetDate = [new Date(today), new Date(today), new Date(today)].map((date, index) => {
        date.setDate(date.getDate() + index);
        return date.getFullYear() + '-' + ('0' + (date.getMonth() + 1)).slice(-2) + '-' + ('0' + date.getDate()).slice(-2);
    })
    const appointmentDataInput = document.querySelector('.appointmentDataPicker input[name="appointmentDate"]');
    const appointmentTimeInput = document.querySelectorAll('.appointmentDataPicker input[name="appointmentTime"]');
    const submitButton = document.querySelector('#apptForm fieldset.submit');
    const cancelButton = document.querySelector('#apptForm .cancel-btn');
    const userNameInput = document.querySelector('#apptForm .form-group');

    appointmentTimeInput.forEach(item => {
        item.addEventListener('change', () => {
            userNameInput.removeAttribute('style');
            submitButton.removeAttribute('style');
            cancelButton.removeAttribute('style');
        })
    })
    const appointments = [];
    temp.forEach(appointmentRaw => {
        const index = appointments.findIndex(appointment => appointment.appointmentDate === appointmentRaw.appointmentDate)
        if (index > -1) {
            appointments[index].appointmentTime = appointments[index].appointmentTime.concat([appointmentRaw.appointmentTime]);
        } else {
            appointments.push({
                appointmentDate: appointmentRaw.appointmentDate,
                appointmentTime: [appointmentRaw.appointmentTime]
            })
        }
    });

    const appointmentsDates = appointments.map(appointment => {
        if (appointment.appointmentTime.indexOf("11:00:00") >= 0 && appointment.appointmentTime.indexOf("13:00:00") >= 0 && appointment.appointmentTime.indexOf("15:00:00") >= 0) {
            return appointment.appointmentDate;
        } else {
            return null;
        }
    })
    const leaveDates = leave.map(date=>{
        return date.leaveDate;
    })
    const disableDates = appointmentsDates.concat(leaveDates);

    const myCalendar = new PSdatapicker({
        nav: ['<span class="fa fa-arrow-left" aria-hidden="true"></span>', '<span class="fa fa-arrow-right" aria-hidden="true"></span>'],
        lang: 'pl',
        format: "yyyy-mm-dd",
        disablePastDays: true,
        disabledDaysOfWeek: [1, 6, 0],
        weekStart: 1,
        disableDates: offsetDate.concat(disableDates),
        langFolder: '../static/assets/langs/',
        onNavigation: () => {
            appointmentTimeInput.forEach(checkBox => {
                checkBox.disabled = true;
                checkBox.checked = false;
            })
            myCalendar.daysSelected = [];
            myCalendar.update();
            submitButton.style.display = 'none';
            cancelButton.style.display = 'none';
            userNameInput.style.display = 'none';
        },
        onSelect: () => {
            document.querySelector('.appointmentTimeButtons').removeAttribute('style');
            let selected = myCalendar.getDays();
            const splitDate = selected[0].split('-')
            splitDate[1] = ('0'+splitDate[1]).slice(-2)
            splitDate[2] = ('0'+splitDate[2]).slice(-2)
            selected = splitDate.join('-')
            
            appointmentTimeInput.forEach(checkBox => {
                checkBox.disabled = true;
                checkBox.checked = false;
            })
            if (![...appointmentTimeInput].filter(checkbox => checkbox.checked).length) {
                submitButton.style.display = 'none';
                cancelButton.style.display = 'none';
            }
            appointmentDataInput.value = selected;
            const list = appointments.filter(appointment => {
                const selectedDate = new Date(selected);
                const tempDate = new Date(appointment.appointmentDate);
                selectedDate.setHours(0, 0, 0, 0);
                tempDate.setHours(0, 0, 0, 0);

                if (selectedDate.toJSON() === tempDate.toJSON()) {
                    return true;
                } else {
                    return false;
                }
            })
            if (list) {
                const hoursList = list.reduce((acc, item) => {
                    return acc.concat(item.appointmentTime);
                }, [])
                appointmentTimeInput.forEach(checkBox => {
                    if (hoursList.indexOf(checkBox.value) < 0) {
                        checkBox.disabled = false;
                    }
                })

            }

        },

    })

</script>

</body>

</html>
